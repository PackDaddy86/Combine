<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAS Calculator - NFL Draft Grades</title>
    <link rel="icon" href="../../assets/images/logo.png" type="image/png">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="ras.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="/assets/js/firebase-config.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-analytics-compat.js"></script>
    <script src="../../assets/js/firebase-analytics.js"></script>
    <script src="/assets/js/user-data.js"></script>
    <script src="../combine-auth.js"></script>
    
    <!-- Include script -->
    <script src="/assets/js/include.js"></script>
</head>
<body>
    <div id="header-include"></div>

    <div class="container">
        <header>
            <a href="../index.html" class="back-button">‚Üê BACK TO COMBINE</a>
            <h1>RELATIVE ATHLETIC SCORE</h1>
        </header>

        <div class="card-container">
            <div class="ras-card">
                <!-- Header Section with Logo and Player Info -->
                <div class="card-header">
                    <div class="logo-left">RAS</div>
                    <div class="pro-bowl-logo">
                        <img src="../../assets/images/logo.png" alt="NFL Draft Grades Logo" class="nfl-logo">
                        <div class="trophy"></div>
                    </div>
                    <div class="logo-right">
                        <img src="../sprites/football-icon.png" alt="Football Icon" class="football-icon">
                    </div>
                </div>

                <!-- Player Info Banner -->
                <div class="player-info">
                    <h2 id="player-name">YOUR NAME | POS | SCHOOL | YEAR</h2>
                </div>

                <!-- Main Metrics Grid -->
                <div class="metrics-grid">
                    <!-- Hand Size and Arm Length -->
                    <div class="metric-row top-row">
                        <div class="metric-label">HAND SIZE</div>
                        <div class="player-info" style="text-align: center; padding: 10px;">
                            <div class="player-position" id="position-display"></div>
                            <div class="player-name" id="name-display"></div>
                        </div>
                        <div class="metric-label">ARM LENGTH</div>
                    </div>

                    <!-- Composite Size Grade -->
                    <div class="grade-row">
                        <div class="composite-grade size-grade" id="size-grade">COMPOSITE SIZE GRADE : OKAY</div>
                        <div class="composite-grade speed-grade" id="speed-grade">COMPOSITE SPEED GRADE : GOOD</div>
                    </div>

                    <!-- Height and 40-Yard Dash -->
                    <div class="metric-row">
                        <div class="metric-label">HEIGHT</div>
                        <div class="metric-value" id="height-value">0'0"</div>
                        <div class="metric-score" id="height-score">0.00</div>
                        <div class="metric-label">40 YD DASH</div>
                        <div class="metric-value" id="forty-value">0.00</div>
                        <div class="metric-score" id="forty-score">0.00</div>
                    </div>

                    <!-- Weight and 20-Yard Split -->
                    <div class="metric-row">
                        <div class="metric-label">WEIGHT</div>
                        <div class="metric-value" id="weight-value">0</div>
                        <div class="metric-score" id="weight-score">0.00</div>
                        <div class="metric-label">20 YD SPLIT</div>
                        <div class="metric-value" id="twenty-value">0.00</div>
                        <div class="metric-score" id="twenty-score">0.00</div>
                    </div>

                    <!-- Bench and 10-Yard Split -->
                    <div class="metric-row">
                        <div class="metric-label">BENCH</div>
                        <div class="metric-value" id="bench-value">0</div>
                        <div class="metric-score" id="bench-score">0.00</div>
                        <div class="metric-label">10 YD SPLIT</div>
                        <div class="metric-value" id="ten-value">0.00</div>
                        <div class="metric-score" id="ten-score">0.00</div>
                    </div>

                    <!-- Composite Explosion and Agility Grades -->
                    <div class="grade-row">
                        <div class="composite-grade explosion-grade" id="explosion-grade">COMPOSITE EXPLOSION GRADE : GOOD</div>
                    </div>

                    <!-- Vertical and Broad -->
                    <div class="metric-row">
                        <div class="metric-label">VERTICAL</div>
                        <div class="metric-value" id="vertical-value">0.0</div>
                        <div class="metric-score" id="vertical-score">0.00</div>
                        <div class="metric-label">BROAD</div>
                        <div class="metric-value" id="broad-value">0'0"</div>
                        <div class="metric-score" id="broad-score">0.00</div>
                    </div>

                    <!-- Separate Agility Grade -->
                    <div class="grade-row">
                        <div class="composite-grade agility-grade" id="agility-grade">COMPOSITE AGILITY GRADE : OKAY</div>
                    </div>

                    <!-- Shuttle and 3-Cone -->
                    <div class="metric-row">
                        <div class="metric-label">SHUTTLE</div>
                        <div class="metric-value" id="shuttle-value">0.00</div>
                        <div class="metric-score" id="shuttle-score">0.00</div>
                        <div class="metric-label">3-CONE</div>
                        <div class="metric-value" id="cone-value">0.00</div>
                        <div class="metric-score" id="cone-score">0.00</div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="card-footer">
                    ATHLETIC TESTING ON A SCALE OF 0 TO 10
                </div>
            </div>
        </div>

        <!-- Player Information Form -->
        <div class="player-form">
            <h2>EDIT PLAYER INFORMATION</h2>
            <form id="player-info-form">
                <div class="form-group">
                    <label for="name">Name:</label>
                    <input type="text" id="name" placeholder="e.g. AARON RODGERS">
                </div>

                <div class="form-group">
                    <label for="position">Position:</label>
                    <input type="text" id="position" placeholder="e.g. QB">
                </div>

                <div class="form-group">
                    <label for="school">School:</label>
                    <input type="text" id="school" placeholder="e.g. CALIFORNIA">
                </div>

                <div class="form-group">
                    <label for="year">Year:</label>
                    <input type="text" id="year" placeholder="e.g. 2005">
                </div>

                <div class="form-group">
                    <label for="height">Height:</label>
                    <input type="text" id="height" placeholder="e.g. 6'2\"">
                </div>

                <div class="form-group">
                    <label for="weight">Weight:</label>
                    <input type="text" id="weight" placeholder="e.g. 225">
                </div>

                <button type="button" id="update-info">UPDATE INFO</button>
            </form>

            <div class="share-buttons">
                <button id="save-card">SAVE AS IMAGE</button>
                <button id="share-card">SHARE RESULTS</button>
                <a href="../index.html" class="return-button">RETURN TO COMBINE</a>
            </div>
        </div>
    </div>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="ras.js"></script>
    <script src="ras-data-fix.js"></script>
    <script src="auto-calculator.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the UI first
            if (typeof setupExtraFeatures === 'function') {
                console.log("Setting up extra features...");
                setupExtraFeatures();
            } else {
                console.log("setupExtraFeatures not found, will try to add debug UI another way...");
                
                // Fallback debug UI
                const container = document.createElement('div');
                container.style.margin = '15px';
                
                const btn = document.createElement('button');
                btn.textContent = 'Refresh User Data';
                btn.style.padding = '10px';
                btn.addEventListener('click', function() {
                    console.log("Manually refreshing data...");
                    
                    // Try all methods in sequence
                    setTimeout(function() {
                        window.loadFromNestedCombineData();
                    }, 0);
                    
                    setTimeout(function() {
                        window.enhancedGetUserData();
                    }, 500);
                    
                    setTimeout(function() {
                        window.inspectAllFirestoreData();
                    }, 1000);
                });
                
                container.appendChild(btn);
                document.body.insertBefore(container, document.body.firstChild);
            }
        
            // Wait for Firebase to be ready before loading data
            const loadAllData = function() {
                console.log("Starting data load sequence...");
                
                // Try nested structure first
                if (typeof window.loadFromNestedCombineData === 'function') {
                    console.log("Trying to load from nested data structure...");
                    window.loadFromNestedCombineData();
                }
                
                // After a delay, try enhanced loader
                setTimeout(function() {
                    if (typeof window.enhancedGetUserData === 'function') {
                        console.log("Trying enhanced user data loader...");
                        window.enhancedGetUserData();
                    }
                }, 1000);
                
                // After another delay, try fallback method
                setTimeout(function() {
                    if (typeof window.inspectAllFirestoreData === 'function') {
                        console.log("Trying fallback data inspector...");
                        window.inspectAllFirestoreData();
                    }
                    
                    // Final calculation update after all data loading attempts
                    setTimeout(function() {
                        console.log("Final calculation update after all loading attempts");
                        if (typeof window.forceRecalculateAllScores === 'function') {
                            window.forceRecalculateAllScores();
                        } else if (typeof updateRASCalculations === 'function') {
                            updateRASCalculations();
                        } else {
                            // Fallback if function not available
                            if (typeof calculateRASScores === 'function') {
                                calculateRASScores();
                            }
                            if (typeof fixAllScores === 'function') {
                                fixAllScores();
                            }
                            if (typeof updateAllGrades === 'function') {
                                updateAllGrades();
                            }
                        }
                    }, 1000);
                }, 2000);
            };
            
            // Check if we already have Firebase
            if (typeof firebase !== 'undefined' && firebase.auth) {
                firebase.auth().onAuthStateChanged(function(user) {
                    if (user) {
                        console.log("User already authenticated, loading data...");
                        loadAllData();
                    } else {
                        console.log("User not authenticated, will wait for login");
                    }
                });
            } else {
                // Wait a bit longer for Firebase to initialize
                console.log("Firebase not yet available, will wait...");
                setTimeout(function() {
                    if (typeof firebase !== 'undefined' && firebase.auth) {
                        console.log("Firebase now available, checking auth...");
                        const user = firebase.auth().currentUser;
                        if (user) {
                            console.log("User is authenticated, loading data...");
                            loadAllData();
                        }
                    } else {
                        console.log("Firebase still not available after delay");
                    }
                }, 3000);
            }
        });
    </script>
    
    <!-- Navigation Script -->
    <script src="../../assets/js/navigation.js"></script>
    
</body>
</html>
